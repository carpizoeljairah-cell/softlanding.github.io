<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Development Test Bank App - Standalone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        #app-container::-webkit-scrollbar { width: 8px; }
        #app-container::-webkit-scrollbar-track { background: #e5e7eb; }
        #app-container::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 4px; }
        #app-container::-webkit-scrollbar-thumb:hover { background: #6b7280; }

        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            padding-bottom: 1rem;
        }
    </style>

    <script type="module">
        // üö® No Firebase or any other database SDK is imported. üö®
        
        // Mock authentication state and User ID generation (no actual authentication takes place)
        window.isAuthReady = true; // Always ready since there's no network delay
        window.getUserId = () => sessionStorage.getItem('localUserId') || (sessionStorage.setItem('localUserId', crypto.randomUUID()), sessionStorage.getItem('localUserId'));
        window.getAppId = () => "standalone-testbank"; // Just a local identifier
    </script>


</head>
<body class="min-h-screen flex items-start justify-center p-4 sm:p-8">

    <div id="app-container" class="w-full max-w-2xl bg-white rounded-xl p-6 sm:p-8 card mt-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-800">Development Test Bank (Local)</h1>
            <div id="header-info" class="header-section">
                <p id="user-info" class="text-sm text-gray-500 font-medium"></p>
                <p id="category-title" class="text-xl font-semibold text-indigo-600 mt-2"></p>
            </div>
        </header>

        <div id="content">
            <div class="text-center p-8 text-gray-500">Loading Application...</div>
        </div>

    </div>

    <div id="message-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm transform transition-all">
            <h3 class="text-2xl font-bold text-gray-800 mb-4" id="modal-title">Notification</h3>
            <p id="modal-message" class="text-gray-700 mb-6"></p>
            <div id="modal-custom-content"></div>
            <button id="modal-default-button" onclick="hideMessageBox()" class="w-full py-2 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 transition shadow-md">OK, Got it!</button>
        </div>
    </div>


    <script type="module">
        // --- 1. QUIZ DATA --- (Unchanged, remains local)
        const quizData = {
            "Garments": {
                name: "Garments",
                questions: [
                    { q: "What is the primary tool used for taking body measurements?", a: "Tape measure", b: "Ruler", c: "Chalk", d: "Pin cushion", ans: 'a' },
                    { q: "Which sewing machine part moves the fabric forward?", a: "Feed dog", b: "Needle bar", c: "Bobbin case", d: "Tension disc", ans: 'a' },
                    { q: "The process of joining two fabric pieces using stitches is called:", a: "Darning", b: "Seaming", c: "Tacking", d: "Pressing", ans: 'b' },
                    { q: "What is used to temporarily hold fabric pieces together?", a: "Straight stitch", b: "Pins", c: "Seam ripper", d: "Bias tape", ans: 'b' },
                    { q: "Which pattern marking indicates the direction of fabric grain?", a: "Notches", b: "Grainline arrow", c: "Button symbol", d: "Cutting line", ans: 'b' }
                ]
            },
            "Computer Hardware Servicing": {
                name: "Computer Hardware Servicing (CHS)",
                questions: [
                    { q: "What is the brain of the computer?", a: "RAM", b: "Hard drive", c: "CPU", d: "Motherboard", ans: 'c' },
                    { q: "What tool is best for removing small screws?", a: "Phillips screwdriver", b: "Pliers", c: "Flat screwdriver", d: "Crimper", ans: 'a' },
                    { q: "Thermal paste is used to:", a: "Reduce heat between CPU and heatsink", b: "Store data", c: "Clean contacts", d: "Cool GPU directly", ans: 'a' },
                    { q: "Which device converts AC to DC?", a: "Motherboard", b: "Power Supply Unit", c: "RAM", d: "SSD", ans: 'b' },
                    { q: "What is the standard port for monitors?", a: "VGA/HDMI", b: "RJ45", c: "PS/2", d: "Audio jack", ans: 'a' }
                ]
            },
            "Electronics / Electrical Technology": {
                name: "Electronics / Electrical Technology (Eltech)",
                questions: [
                    { q: "What unit measures electrical current?", a: "Volt", b: "Watt", c: "Ampere", d: "Ohm", ans: 'c' },
                    { q: "A resistor is used to:", a: "Increase voltage", b: "Limit current", c: "Store charge", d: "Open a circuit", ans: 'b' },
                    { q: "Which tool measures voltage, current, and resistance?", a: "Soldering iron", b: "Multimeter", c: "Oscilloscope", d: "Clamp meter", ans: 'b' },
                    { q: "What color typically indicates the ground wire?", a: "Red", b: "Black", c: "Green", d: "Blue", ans: 'c' },
                    { q: "Which component stores electrical energy?", a: "Diode", b: "Transistor", c: "Capacitor", d: "Fuse", ans: 'c' }
                ]
            }
        };

        // --- 2. APPLICATION STATE --- (Unchanged)
        let currentCategory = null;
        let currentQuestionIndex = 0;
        let score = 0;
        let quizRunning = false;
        let userName = ''; 
        
        // --- ADMIN LOGIN CONFIGURATION ---
        const ADMIN_SECRET_KEY = "TestBankAdmin2025"; // Keep for local admin access check
        let isAdminLoggedIn = false; 

        // --- DOM Elements --- (Unchanged)
        const contentDiv = document.getElementById('content');
        const categoryTitleElement = document.getElementById('category-title');
        const userInfoElement = document.getElementById('user-info');
        const modal = document.getElementById('message-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalDefaultButton = document.getElementById('modal-default-button');
        const modalCustomContent = document.getElementById('modal-custom-content');

        // --- 3. CORE LOGIC FUNCTIONS --- (Modified to remove database calls)

        // Function to display custom message box (Unchanged)
        function showMessageBox(message, title = "Notification") {
            modalTitle.textContent = title;
            modalMessage.innerHTML = message;
            modalCustomContent.innerHTML = ''; 
            modalDefaultButton.style.display = 'block';
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Function to hide custom message box (Unchanged)
        window.hideMessageBox = function() {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            modalCustomContent.innerHTML = ''; 
        }

        // Helper to map option letter to text (Unchanged)
        function getOptionText(question, option) {
            switch (option) {
                case 'a': return question.a;
                case 'b': return question.b;
                case 'c': return question.c;
                case 'd': return question.d;
                default: return '';
            }
        }

        // Handles user selecting an answer (Unchanged logic, just relies on local score)
        function handleAnswerClick(userAns) {
            if (!quizRunning) return; 

            const currentQ = currentCategory.questions[currentQuestionIndex];
            const isCorrect = userAns === currentQ.ans;

            // Highlight the correct/incorrect answers on the UI
            const optionElements = contentDiv.querySelectorAll('.quiz-option');
            optionElements.forEach(el => {
                const optionLetter = el.getAttribute('data-option');
                if (optionLetter === currentQ.ans) {
                    el.classList.remove('bg-indigo-100', 'hover:bg-indigo-200');
                    el.classList.add('bg-green-200', 'border-green-500'); 
                } else if (optionLetter === userAns) {
                    el.classList.remove('bg-indigo-100', 'hover:bg-indigo-200');
                    el.classList.add('bg-red-200', 'border-red-500'); 
                }
                el.disabled = true; 
            });

            if (isCorrect) {
                score++;
            }

            quizRunning = false; 

            // Move to the next question or results after a short delay
            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < currentCategory.questions.length) {
                    renderQuiz();
                } else {
                    renderResults();
                }
                quizRunning = true; 
            }, 1000); 
        }

        // Resets the quiz state for a new attempt (Unchanged)
        function resetQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            quizRunning = true;
        }

        // üóëÔ∏è REMOVED: saveResult function - no saving to a database anymore.
        
        // --- 4. ADMIN LOGIN & LOGOUT --- (Retained for local access to the 'admin view' history)

        window.showAdminLoginPrompt = function() {
            modalTitle.textContent = "Admin Login Required";
            modalMessage.innerHTML = `<p class="text-sm text-gray-500">Enter the secret key to access the administration panel.</p>`;
            modalDefaultButton.style.display = 'none'; 
            
            modalCustomContent.innerHTML = `
                <input 
                    id="admin-key-input"
                    type="password" 
                    placeholder="Secret Admin Key" 
                    class="w-full p-3 border-2 border-yellow-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 mb-4"
                    onkeydown="if(event.key === 'Enter') attemptAdminLogin(document.getElementById('admin-key-input').value)"
                />
                <button 
                    class="w-full py-2 bg-yellow-600 text-white font-semibold rounded-lg hover:bg-yellow-700 transition shadow-md"
                    onclick="attemptAdminLogin(document.getElementById('admin-key-input').value)"
                >
                    Login
                </button>
            `;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.getElementById('admin-key-input').focus();
        };

        window.attemptAdminLogin = function(key) {
            if (key === ADMIN_SECRET_KEY) {
                isAdminLoggedIn = true;
                hideMessageBox();
                showMessageBox(`Welcome back, Creator! Admin view is now enabled. (History view is disabled in this standalone version)`, "Admin Access Granted");
                renderMenu(); 
            } else {
                showMessageBox(`Incorrect secret key. Access denied.`, "Login Failed");
            }
        };

        window.adminLogout = function() {
            isAdminLoggedIn = false;
            showMessageBox(`Admin access has been revoked.`, "Admin Logged Out");
            renderMenu(); 
        };

        // --- 5. ACCOUNT DELETION LOGIC ---
        // üóëÔ∏è REMOVED: All account deletion logic as there is no account or private data to delete.

        // --- 6. RENDER FUNCTIONS ---
        // renderNameInput, validateName, renderQuiz, renderResults: Logic unchanged, but references to saving/loading are removed.
        
        function renderNameInput() {
            window.contentRendered = true; 
            categoryTitleElement.textContent = "Welcome";
            userInfoElement.innerHTML = '';

            let html = `
                <p class="text-lg text-gray-600 mb-6 text-center">Please enter your name to start the Test Bank application.</p>
                <div class="space-y-4">
                    <input 
                        id="name-input"
                        type="text" 
                        placeholder="Your Name" 
                        value="${userName}"
                        class="w-full p-3 border-2 border-indigo-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"
                        onkeydown="if(event.key === 'Enter') validateName()"
                    />
                    <button 
                        class="w-full py-3 bg-indigo-500 text-white rounded-lg hover:bg-indigo-700 transition duration-150 font-semibold text-lg shadow-md"
                        onclick="validateName()"
                    >
                        Continue
                    </button>
                </div>
            `;
            contentDiv.innerHTML = html;
        }

        window.validateName = function() {
            const nameInput = document.getElementById('name-input');
            const name = nameInput.value.trim();

            if (name.length > 0) {
                userName = name;
                renderMenu();
            } else {
                showMessageBox("Please enter a valid name to continue.");
            }
        };


        window.renderMenu = function() {
            if (!userName) return renderNameInput();

            categoryTitleElement.textContent = `Hello, ${userName}!`;
            userInfoElement.innerHTML = `Local ID: <span class="font-mono text-xs">${window.getUserId().substring(0, 8)}...</span>`;
            
            const categoryKeys = Object.keys(quizData);
            let html = `
                <p class="text-lg text-gray-600 mb-6 text-center">Select a category to begin your quiz.</p>
                <div class="grid grid-cols-1 md:grid-cols-1 gap-4">
            `;

            categoryKeys.forEach(key => {
                const category = quizData[key];
                html += `
                    <button 
                        class="w-full text-left p-4 bg-indigo-500 text-white rounded-lg hover:bg-indigo-700 transition duration-150 font-semibold text-lg shadow-md"
                        onclick="startQuiz('${key}')"
                    >
                        ${category.name}
                    </button>
                `;
            });

            html += `
                </div>
                <div class="mt-8 grid grid-cols-3 gap-4">
                    <button 
                        onclick="showMessageBox('History is disabled in this standalone version as no database is connected.')" 
                        class="py-2 bg-gray-400 text-gray-700 rounded-lg font-semibold shadow-md col-span-2 disabled:opacity-50"
                        disabled
                    >
                        My History (Disabled)
                    </button>
                    <button 
                        onclick="showMessageBox('No account to delete in this standalone version.')" 
                        class="py-2 bg-gray-400 text-gray-700 rounded-lg font-semibold shadow-md col-span-1 disabled:opacity-50"
                        disabled
                    >
                        Delete Account (Disabled)
                    </button>
                    <button 
                        onclick="showMessageBox('Thank you for using the Development Test Bank App, ${userName}.')" 
                        class="py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition duration-150 font-semibold col-span-3"
                    >
                        Exit Program
                    </button>
                    
                    ${isAdminLoggedIn ? `
                        <button 
                            onclick="showMessageBox('Admin View is only for data retrieval, which is disabled in this standalone version.')" 
                            class="py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition duration-150 font-semibold shadow-md mt-4 col-span-2"
                        >
                            Admin View (Disabled)
                        </button>
                        <button 
                            onclick="adminLogout()" 
                            class="py-2 bg-red-300 text-red-800 rounded-lg hover:bg-red-400 transition duration-150 font-semibold shadow-md mt-4 col-span-1"
                        >
                            Logout Admin
                        </button>
                    ` : `
                        <button 
                            onclick="showAdminLoginPrompt()" 
                            class="col-span-3 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition duration-150 font-semibold shadow-md mt-4"
                        >
                            Admin Login (Local)
                        </button>
                    `}
                </div>
            `;
            contentDiv.innerHTML = html;
        }

        // renderQuiz function (Unchanged)
        function renderQuiz() {
            if (!currentCategory || currentQuestionIndex >= currentCategory.questions.length) {
                return renderMenu(); 
            }

            const currentQ = currentCategory.questions[currentQuestionIndex];
            const qNum = currentQuestionIndex + 1;
            const totalQ = currentCategory.questions.length;

            categoryTitleElement.textContent = `${currentCategory.name} | ${userName}`;

            let html = `
                <div class="mb-6">
                    <p class="text-sm text-indigo-600 font-medium mb-1">Question ${qNum} of ${totalQ}</p>
                    <h2 class="text-2xl font-bold text-gray-800">${currentQ.q}</h2>
                </div>
                <div class="space-y-3">
            `;
            
            const options = ['a', 'b', 'c', 'd'];

            options.forEach(opt => {
                const optionText = getOptionText(currentQ, opt);
                html += `
                    <button 
                        class="quiz-option w-full text-left p-4 bg-indigo-100 text-gray-800 rounded-lg border-2 border-indigo-200 hover:bg-indigo-200 transition duration-150 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:opacity-100"
                        data-option="${opt}"
                        onclick="handleAnswerClick('${opt}')"
                        >
                        <span class="font-bold uppercase mr-2">${opt})</span> ${optionText}
                    </button>
                `;
            });

            html += `
                </div>
                <div class="mt-6 text-right text-gray-500 font-medium">
                    Current Score: ${score}
                </div>
            `;

            contentDiv.innerHTML = html;
            quizRunning = true;
        }

        // renderResults function (Modified: removed saveResult call)
        function renderResults() {
            const totalQ = currentCategory.questions.length;
            const percentage = (score / totalQ * 100).toFixed(0);

            // üóëÔ∏è REMOVED: saveResult(currentCategory.name, score, totalQ);

            categoryTitleElement.textContent = `${currentCategory.name} - Results`;

            let html = `
                <div class="text-center p-6 bg-green-50 rounded-lg border-2 border-green-300 mb-8">
                    <p class="text-3xl font-extrabold text-gray-800 mb-2">${userName}, Quiz Complete!</p>
                    <p class="text-4xl font-black text-green-700">You scored ${score} / ${totalQ}</p>
                    <p class="text-lg text-gray-600 mt-2">${percentage}% accuracy</p>
                    <p class="text-sm text-gray-500 mt-2 text-red-500 font-medium">(Note: Result was NOT saved to a database.)</p>
                </div>

                <p class="text-xl font-semibold text-gray-700 mb-4">What would you like to do next?</p>
                <div class="space-y-4">
                    <button 
                        class="w-full py-3 bg-indigo-500 text-white rounded-lg hover:bg-indigo-700 transition duration-150 font-semibold text-lg shadow-md"
                        onclick="startQuiz(currentCategory.name)"
                    >
                        Try this category again (A)
                    </button>
                    <button 
                        class="w-full py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition duration-150 font-semibold text-lg shadow-md"
                        onclick="renderMenu()"
                    >
                        Choose another category (B)
                    </button>
                    <button 
                        class="w-full py-3 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition duration-150 font-semibold text-lg shadow-md"
                        onclick="showMessageBox('Thank you for using the Development Test Bank App, ${userName}.')"
                    >
                        Exit the program (C)
                    </button>
                </div>
            `;

            contentDiv.innerHTML = html;
            quizRunning = false;
        }
        
        // üóëÔ∏è REMOVED: renderHistory and fetchHistory functions.

        // --- 7. INITIALIZATION & PUBLIC ACCESSORS ---

        window.startQuiz = (categoryName) => {
            if (quizData[categoryName]) {
                currentCategory = quizData[categoryName];
                resetQuiz();
                renderQuiz();
            } else {
                console.error("Invalid category name:", categoryName);
                window.renderMenu();
            }
        };

        // Expose necessary functions
        window.handleAnswerClick = handleAnswerClick;

        // Start the application by rendering the name input screen immediately
        document.addEventListener('DOMContentLoaded', () => {
            window.contentRendered = false; 
            renderNameInput();
        });
    </script>
</body>
</html>
